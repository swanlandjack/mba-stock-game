<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Jedi Terminal - Stock Game</title>
    <style>
        /* --- BLOOMBERG THEME STYLES --- */
        body {
            font-family: 'Consolas', 'Courier New', monospace;
            background-color: #000000;
            color: #e0e0e0;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }

        /* Grid Layout */
        .terminal-grid {
            display: grid;
            grid-template-columns: 250px 1fr 250px;
            grid-template-rows: 40px 1fr 30px;
            height: 100vh;
            gap: 2px;
            background-color: #333;
        }

        /* Header */
        header {
            grid-column: 1 / -1;
            background-color: #1a1a1a;
            display: flex;
            align-items: center;
            padding: 0 15px;
            border-bottom: 2px solid #ff9900;
            color: #ff9900;
            font-weight: bold;
        }

        /* Panels */
        .panel {
            background-color: #000;
            padding: 15px;
            overflow-y: auto;
            border: 1px solid #222;
        }

        h2 { border-bottom: 1px dashed #555; padding-bottom: 5px; color: #ff9900; font-size: 16px; }
        
        .input-group { margin: 20px 0; }
        label { display: block; color: #00ccff; margin-bottom: 5px; }
        
        input[type="text"] {
            background: #111; border: 1px solid #444; color: #fff;
            padding: 10px; width: 80%; font-family: inherit; font-size: 18px;
            text-transform: uppercase;
        }

        .btn-container { display: flex; gap: 10px; margin-top: 20px; }
        
        button {
            flex: 1; padding: 15px; font-family: inherit; font-size: 16px; font-weight: bold;
            cursor: pointer; border: none; color: #000; transition: 0.2s;
        }
        .btn-up { background-color: #00ff00; }
        .btn-up:hover { background-color: #ccffcc; }
        
        .btn-down { background-color: #ff3333; }
        .btn-down:hover { background-color: #ffcccc; }

        /* Results Box */
        #result-screen {
            margin-top: 30px; padding: 20px; border: 1px solid #444;
            display: none;
        }
        .win { border-color: #00ff00; color: #00ff00; }
        .loss { border-color: #ff0000; color: #ff0000; }
        
        .big-text { font-size: 24px; font-weight: bold; margin-bottom: 10px; display: block; }

        footer {
            grid-column: 1 / -1; background: #111; color: #ff9900;
            padding: 5px 15px; font-size: 12px; display: flex; align-items: center;
        }
    </style>
</head>
<body>

    <div class="terminal-grid">
        
        <header>
            OAIJ <GO> | MARKET PREDICTOR MODULE v1.0
        </header>

        <div class="panel">
            <h2>INSTRUCTIONS</h2>
            <p style="color: #ccc; font-size: 13px; line-height: 1.6;">
                1. Enter a Stock Ticker (e.g., TSLA, NVDA).<br><br>
                2. Predict if the stock closed 
                <span style="color:#00ff00">HIGHER</span> or 
                <span style="color:#ff3333">LOWER</span> yesterday compared to the day before.<br><br>
                3. The System calls the Cloud API to verify live market data.
            </p>
        </div>

        <div class="panel" style="text-align: center;">
            <div style="max-width: 500px; margin: 0 auto; text-align: left;">
                
                <h2>ENTER TRADING SYMBOL</h2>
                
                <div class="input-group">
                    <label>TICKER SYMBOL</label>
                    <input type="text" id="tickerInput" value="AAPL" placeholder="Ex: GOOGL">
                </div>

                <div class="btn-container">
                    <button class="btn-up" onclick="makeGuess('UP')">‚ñ≤ PRICE WENT UP</button>
                    <button class="btn-down" onclick="makeGuess('DOWN')">‚ñº PRICE WENT DOWN</button>
                </div>

                <div id="loader" style="display:none; color: #00ccff; margin-top:20px;">
                    [CONNECTING TO LIVE MARKET DATA...]
                </div>

                <div id="result-screen">
                    <span id="result-title" class="big-text"></span>
                    <p id="result-details" style="color: #fff;"></p>
                </div>

            </div>
        </div>

        <div class="panel">
            <h2>SYSTEM STATUS</h2>
            <div style="font-size: 12px;">
                API STATUS: <span style="color: #00ff00">ONLINE</span><br>
                CONNECTION: SECURE (HTTPS)<br>
                MODE: CLOUD DEPLOYMENT
            </div>
        </div>

        <footer>
            OAIJ TERMINAL | CONNECTED TO PYTHON BACKEND | PRESS F11 FOR FULL SCREEN
        </footer>

    </div>

    <script>
        async function makeGuess(prediction) {
            
            // 1. Get Ticker
            const ticker = document.getElementById('tickerInput').value.toUpperCase();
            if(!ticker) { alert("Please enter a ticker!"); return; }

            // 2. Show Loading
            document.getElementById('loader').style.display = 'block';
            document.getElementById('result-screen').style.display = 'none';

            // 3. Define API URL (RELATIVE PATH FOR CLOUD)
            // This automatically works on Localhost AND Render
            const apiUrl = `/guess?ticker=${ticker}&prediction=${prediction}`;

            try {
                // 4. Call Python
                const response = await fetch(apiUrl);
                
                // Check if the response is valid
                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }

                const data = await response.json();

                // 5. Hide Loading
                document.getElementById('loader').style.display = 'none';
                
                // 6. Handle Errors in Data
                if(data.error) {
                    alert("Market Data Error: " + data.error);
                    return;
                }

                // 7. Update UI
                const resultBox = document.getElementById('result-screen');
                const title = document.getElementById('result-title');
                const details = document.getElementById('result-details');

                resultBox.style.display = 'block';
                resultBox.className = ''; // Reset classes

                if (data.result.includes("WIN")) {
                    resultBox.classList.add('win');
                    title.innerText = "üèÜ PROFIT! (CORRECT)";
                } else {
                    resultBox.classList.add('loss');
                    title.innerText = "‚ùå LOSS (WRONG)";
                }

                details.innerText = data.details;

            } catch (error) {
                console.error(error);
                document.getElementById('loader').style.display = 'none';
                alert("Connection Failed! The Python Backend is not responding.");
            }
        }
    </script>
</body>
</html>